<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.151.0">
    <meta
  name="description"
  content=""
/>
<meta name="author" content="truongnvse182034@fpt.edu.vn" />

    <link rel="icon" href="../../../../images/favicon.png" type="image/png">

    <title>5.4.5 Backend Stack :: BÃ¡o cÃ¡o thá»±c táº­p</title>

    
    <link href="../../../../css/nucleus.css?1765346855" rel="stylesheet">
    <link href="../../../../css/fontawesome-all.min.css?1765346855" rel="stylesheet">
    <link href="../../../../css/hybrid.css?1765346855" rel="stylesheet">
    <link href="../../../../css/featherlight.min.css?1765346855" rel="stylesheet">
    <link href="../../../../css/perfect-scrollbar.min.css?1765346855" rel="stylesheet">
    <link href="../../../../css/auto-complete.css?1765346855" rel="stylesheet">
    <link href="../../../../css/atom-one-dark-reasonable.css?1765346855" rel="stylesheet">
    <link href="../../../../css/theme.css?1765346855" rel="stylesheet">
    <link href="../../../../css/hugo-theme.css?1765346855" rel="stylesheet">
    
    <link href="../../../../css/theme-workshop.css?1765346855" rel="stylesheet">
    
    

    <script src="../../../../js/jquery-3.3.1.min.js?1765346855"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

  </head>
  <body class="" data-url="../../../../vi/5-workshop/5.04-configure-stacks/5.4.5-backend-stack/">
    <nav
  id="sidebar"
  class="showVisitedLinks"
>
   
  <div id="header-wrapper">
    <div id="header"><a id="logo" href="../../../../">
  <svg
    id="Layer_1"
    data-name="Layer 1"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 60 30"
    width="30%"
  >
    <defs>
      <style>
        .cls-1 {
          fill: #fff;
        }
        .cls-2 {
          fill: #f90;
          fill-rule: evenodd;
        }
      </style>
    </defs>
    <title>AWS-Logo_White-Color</title>
    <path
      class="cls-1"
      d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"
    ></path>
    <path
      class="cls-2"
      d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"
    ></path>
    <path
      class="cls-2"
      d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"
    ></path>
  </svg>
</a>
</div>
     <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../../../js/lunr.min.js?1765346855"></script>
<script type="text/javascript" src="../../../../js/auto-complete.js?1765346855"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/nvtruongops.github.io\/fcj-workshop-template\/\/vi";
    
</script>
<script type="text/javascript" src="../../../../js/search.js?1765346855"></script>
 
  </div>

  <div class="highlightable">
    <ul class="topics">
               
<li
  data-nav-id="/vi/1-worklog/"
  title="Nháº­t kÃ½ cÃ´ng viá»‡c"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/">
     <b> 1. </b> Nháº­t kÃ½ cÃ´ng viá»‡c 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/vi/1-worklog/1.1-week1/"
  title="Nháº­t kÃ½ cÃ´ng viá»‡c Tuáº§n 1"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.1-week1/">
     <b> 1.1. </b> Nháº­t kÃ½ cÃ´ng viá»‡c Tuáº§n 1 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.2-week2/"
  title="Nháº­t kÃ½ Tuáº§n 2"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.2-week2/">
     <b> 1.2. </b> Nháº­t kÃ½ Tuáº§n 2 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.3-week3/"
  title="Nháº­t kÃ½ Tuáº§n 3"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.3-week3/">
     <b> 1.3. </b> Nháº­t kÃ½ Tuáº§n 3 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.4-week4/"
  title="Nháº­t kÃ½ Tuáº§n 4"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.4-week4/">
     <b> 1.4. </b> Nháº­t kÃ½ Tuáº§n 4 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.5-week5/"
  title="Nháº­t kÃ½ Tuáº§n 5"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.5-week5/">
     <b> 1.5. </b> Nháº­t kÃ½ Tuáº§n 5 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.6-week6/"
  title="BÃ¡o cÃ¡o cÃ´ng viá»‡c Tuáº§n 6"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.6-week6/">
     <b> 1.6. </b> BÃ¡o cÃ¡o cÃ´ng viá»‡c Tuáº§n 6 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.7-week7/"
  title="BÃ¡o cÃ¡o cÃ´ng viá»‡c Tuáº§n 7"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.7-week7/">
     <b> 1.7. </b> BÃ¡o cÃ¡o cÃ´ng viá»‡c Tuáº§n 7 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.8-week8/"
  title="BÃ¡o cÃ¡o cÃ´ng viá»‡c Tuáº§n 8"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.8-week8/">
     <b> 1.8. </b> BÃ¡o cÃ¡o cÃ´ng viá»‡c Tuáº§n 8 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.9-week9/"
  title="Worklog Tuáº§n 9"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.9-week9/">
     <b> 1.9. </b> Worklog Tuáº§n 9 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.10-week10/"
  title="Worklog Tuáº§n 10"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.10-week10/">
     <b> 1.10. </b> Worklog Tuáº§n 10 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.11-week11/"
  title="Worklog Tuáº§n 11"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.11-week11/">
     <b> 1.11. </b> Worklog Tuáº§n 11 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/1-worklog/1.12-week12/"
  title="Worklog Tuáº§n 12 "
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/1-worklog/1.12-week12/">
     <b> 1.12. </b> Worklog Tuáº§n 12  
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/vi/2-proposal/"
  title="Äá» xuáº¥t dá»± Ã¡n"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/2-proposal/">
     <b> 2. </b> Äá» xuáº¥t dá»± Ã¡n 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
           
<li
  data-nav-id="/vi/3-blogstranslated/"
  title="Blog Dá»‹ch Sang Tiáº¿ng Viá»‡t"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/3-blogstranslated/">
     <b> 3. </b> Blog Dá»‹ch Sang Tiáº¿ng Viá»‡t 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/vi/3-blogstranslated/3.1-blog1/"
  title="Blog 1: AWS Ä‘Æ°á»£c vinh danh lÃ  NhÃ  lÃ£nh Ä‘áº¡o trong Magic Quadrant 2025 cá»§a Gartner vá» Dá»‹ch vá»¥ Ná»n táº£ng ÄÃ¡m mÃ¢y Chiáº¿n lÆ°á»£c trong 15 nÄƒm liÃªn tiáº¿p"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/3-blogstranslated/3.1-blog1/">
     <b> 3.1. </b> Blog 1: AWS Ä‘Æ°á»£c vinh danh lÃ  NhÃ  lÃ£nh Ä‘áº¡o trong Magic Quadrant 2025 cá»§a Gartner vá» Dá»‹ch vá»¥ Ná»n táº£ng ÄÃ¡m mÃ¢y Chiáº¿n lÆ°á»£c trong 15 nÄƒm liÃªn tiáº¿p 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/3-blogstranslated/3.2-blog2/"
  title="Blog 2: CÃ¡c mÃ´ hÃ¬nh Qwen hiá»‡n Ä‘Ã£ cÃ³ sáºµn trong Amazon Bedrock"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/3-blogstranslated/3.2-blog2/">
     <b> 3.2. </b> Blog 2: CÃ¡c mÃ´ hÃ¬nh Qwen hiá»‡n Ä‘Ã£ cÃ³ sáºµn trong Amazon Bedrock 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/3-blogstranslated/3.3-blog3/"
  title="Blog 3: Quáº£n lÃ½ ChÃ­nh sÃ¡ch TÆ°á»ng lá»­a AWS Táº­p trung vá»›i AlgoSec"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/3-blogstranslated/3.3-blog3/">
     <b> 3.3. </b> Blog 3: Quáº£n lÃ½ ChÃ­nh sÃ¡ch TÆ°á»ng lá»­a AWS Táº­p trung vá»›i AlgoSec 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/3-blogstranslated/3.4-blog4/"
  title="Blog 4: HÆ°á»›ng dáº«n cá»‘t lÃµi vá» Quáº£n trá»‹ Cloud táº¡i AWS re:Invent 2025"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/3-blogstranslated/3.4-blog4/">
     <b> 3.4. </b> Blog 4: HÆ°á»›ng dáº«n cá»‘t lÃµi vá» Quáº£n trá»‹ Cloud táº¡i AWS re:Invent 2025 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/3-blogstranslated/3.5-blog5/"
  title="Blog 5: Chiáº¿n lÆ°á»£c Mua sáº¯m Táº­p trung vÃ o Giáº£i phÃ¡p trÃªn AWS Marketplace"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/3-blogstranslated/3.5-blog5/">
     <b> 3.5. </b> Blog 5: Chiáº¿n lÆ°á»£c Mua sáº¯m Táº­p trung vÃ o Giáº£i phÃ¡p trÃªn AWS Marketplace 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/3-blogstranslated/3.6-blog6/"
  title="Blog 6: 10 CÃ´ng bá»‘ HÃ ng Ä‘áº§u vá» AWS Cloud Operations táº¡i re:Invent 2025"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/3-blogstranslated/3.6-blog6/">
     <b> 3.6. </b> Blog 6: 10 CÃ´ng bá»‘ HÃ ng Ä‘áº§u vá» AWS Cloud Operations táº¡i re:Invent 2025 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/vi/4-eventparticipated/"
  title="CÃ¡c events Ä‘Ã£ tham gia"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/4-eventparticipated/">
     <b> 4. </b> CÃ¡c events Ä‘Ã£ tham gia 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/vi/4-eventparticipated/4.1-event1/"
  title="Event 1"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/4-eventparticipated/4.1-event1/">
     <b> 4.1. </b> Event 1 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/4-eventparticipated/4.2-event2/"
  title="Event 2"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/4-eventparticipated/4.2-event2/">
     <b> 4.2. </b> Event 2 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/4-eventparticipated/4.3-event3/"
  title="Event 3"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/4-eventparticipated/4.3-event3/">
     <b> 4.3. </b> Event 3 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/vi/5-workshop/"
  title="Workshop"
  class="dd-item 
     parent
     
     
        "
>
  <a href="../../../../vi/5-workshop/">
     <b> 5. </b> Workshop 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/vi/5-workshop/5.01-workshop-overview/"
  title="Tá»•ng quan Workshop"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.01-workshop-overview/">
     <b> 5.01. </b> Tá»•ng quan Workshop 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.02-setup-environment/"
  title="Thiáº¿t láº­p MÃ´i trÆ°á»ng"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.02-setup-environment/">
     <b> 5.02. </b> Thiáº¿t láº­p MÃ´i trÆ°á»ng 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.03-cdk-bootstrap/"
  title="CDK Bootstrap"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.03-cdk-bootstrap/">
     <b> 5.03. </b> CDK Bootstrap 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.04-configure-stacks/"
  title="Cáº¥u hÃ¬nh cÃ¡c Infrastructure Stack"
  class="dd-item 
     parent
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.04-configure-stacks/">
     <b> 5.04. </b> Cáº¥u hÃ¬nh cÃ¡c Infrastructure Stack 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/vi/5-workshop/5.04-configure-stacks/5.4.1-dns-stack/"
  title="5.4.1 DNS Stack"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.1-dns-stack/">
    5.4.1 DNS Stack 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.04-configure-stacks/5.4.2-certificate-stack/"
  title="5.4.2 Certificate Stack"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.2-certificate-stack/">
    5.4.2 Certificate Stack 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.04-configure-stacks/5.4.3-core-stack/"
  title="5.4.3 Core Stack"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.3-core-stack/">
    5.4.3 Core Stack 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.04-configure-stacks/5.4.4-auth-stack/"
  title="5.4.4 Auth Stack"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.4-auth-stack/">
    5.4.4 Auth Stack 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.04-configure-stacks/5.4.5-backend-stack/"
  title="5.4.5 Backend Stack"
  class="dd-item 
     
     active
     
        "
>
  <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.5-backend-stack/">
    5.4.5 Backend Stack 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.04-configure-stacks/5.4.6-frontend-stack/"
  title="5.4.6 Frontend Stack"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.6-frontend-stack/">
    5.4.6 Frontend Stack 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.04-configure-stacks/5.4.7-observability-stack/"
  title="5.4.7 Observability Stack"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.7-observability-stack/">
    5.4.7 Observability Stack 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.05-deploy-infrastructure/"
  title="Triá»ƒn khai Háº¡ táº§ng"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.05-deploy-infrastructure/">
     <b> 5.05. </b> Triá»ƒn khai Háº¡ táº§ng 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.06-configure-api-lambda/"
  title="Cáº¥u hÃ¬nh API &amp; Lambda"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.06-configure-api-lambda/">
     <b> 5.06. </b> Cáº¥u hÃ¬nh API &amp; Lambda 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.07-deploy-backend/"
  title="Triá»ƒn khai Backend Services"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.07-deploy-backend/">
     <b> 5.07. </b> Triá»ƒn khai Backend Services 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.08-test-endpoints/"
  title="Kiá»ƒm Tra Endpoints ToÃ n Diá»‡n"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.08-test-endpoints/">
     <b> 5.08. </b> Kiá»ƒm Tra Endpoints ToÃ n Diá»‡n 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.09-push-gitlab/"
  title="Push lÃªn GitLab"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.09-push-gitlab/">
     <b> 5.09. </b> Push lÃªn GitLab 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.10-deploy-amplify/"
  title="Deploy lÃªn Amplify"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.10-deploy-amplify/">
     <b> 5.10. </b> Deploy lÃªn Amplify 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/vi/5-workshop/5.11-cleanup/"
  title="Dá»n dáº¹p tÃ i nguyÃªn"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/5-workshop/5.11-cleanup/">
     <b> 5.11. </b> Dá»n dáº¹p tÃ i nguyÃªn 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/vi/6-self-evaluation/"
  title="Tá»± ÄÃ¡nh GiÃ¡"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/6-self-evaluation/">
     <b> 6. </b> Tá»± ÄÃ¡nh GiÃ¡ 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
           
<li
  data-nav-id="/vi/7-feedback/"
  title="Chia Sáº» vÃ  Pháº£n Há»“i"
  class="dd-item 
     
     
     
        "
>
  <a href="../../../../vi/7-feedback/">
     <b> 7. </b> Chia Sáº» vÃ  Pháº£n Há»“i 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
    </ul>

     
    <section id="shortcuts">
      <h3>
        More
      </h3>
      <ul>
        
        <li>
          <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"
            ><i class='fab fa-facebook'></i> AWS Study Group</a
          >
        </li>
        
      </ul>
    </section>
     
    <section id="prefooter">
      <hr />
      <ul>
        
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
            <div class="select-style">
              <select id="select-language" onchange="location = this.value;">
                       
                <option
                  id="en"
                  value="https://nvtruongops.github.io/fcj-workshop-template/5-workshop/5.04-configure-stacks/5.4.5-backend-stack/"
                >
                  English
                </option>
                            
                <option
                  id="vi"
                  value="https://nvtruongops.github.io/fcj-workshop-template/vi/5-workshop/5.04-configure-stacks/5.4.5-backend-stack/"
                  selected
                >
                  Tiáº¿ng Viá»‡t
                </option>
                   
              </select>
              <svg
                version="1.1"
                id="Capa_1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                x="0px"
                y="0px"
                width="255px"
                height="255px"
                viewBox="0 0 255 255"
                style="enable-background: new 0 0 255 255"
                xml:space="preserve"
              >
                <g>
                  <g id="arrow-drop-down">
                    <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
                  </g>
                </g>
              </svg>
            </div>
          </a>
        </li>
         
        <li>
          <a class="padding" href="#" data-clear-history-toggle=""
            ><i class="fas fa-history fa-fw"></i> Clear History</a
          >
        </li>
        
      </ul>
    </section>
    
    <section id="footer"><left>
    
    <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0"
        title="Migrate" Alt="web counter" border="0" /></a> <br>
    <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0"
        title="Total CLoud Journey" Alt="web counter" border="0" />

</left>
<left>
    <br>
    <br>
    <b>Last Updated</b><br>
    <i>
        <span id="lastUpdated" style="color:orange;"></span>
    </i>

    <script>
        
        const today = new Date();
        
        const formattedDate = today.toLocaleDateString('en-GB');
        
        document.getElementById('lastUpdated').textContent = formattedDate;
    </script>
</left>
<left>
    <br>
    <br>
    <b> Team </b> <br>

    <i> <a href="https://www.facebook.com/groups/660548818043427" style="color:orange">First Cloud Journey </a> <br>

    </i>
</left>

<script async defer src="https://buttons.github.io/buttons.js"></script></section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='../../../../vi/'>BÃ¡o cÃ¡o thá»±c táº­p</a> > <a href='../../../../vi/5-workshop/'>Workshop</a> > <a href='../../../../vi/5-workshop/5.04-configure-stacks/'>Cáº¥u hÃ¬nh cÃ¡c Infrastructure Stack</a> > 5.4.5 Backend Stack
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
  <div class="wrapper"><nav id="TableOfContents">
  <ul>
    <li><a href="#tá»•ng-quan">Tá»•ng Quan</a>
      <ul>
        <li><a href="#trÃ¡ch-nhiá»‡m-chÃ­nh">TrÃ¡ch Nhiá»‡m ChÃ­nh</a></li>
        <li><a href="#nhá»¯ng-gÃ¬-stack-nÃ y-bao-gá»“m">Nhá»¯ng GÃ¬ Stack NÃ y Bao Gá»“m</a></li>
      </ul>
    </li>
    <li><a href="#kiáº¿n-trÃºc">Kiáº¿n TrÃºc</a></li>
    <li><a href="#cáº¥u-hÃ¬nh-stack">Cáº¥u HÃ¬nh Stack</a>
      <ul>
        <li><a href="#cáº¥u-trÃºc-file">Cáº¥u TrÃºc File</a></li>
        <li><a href="#triá»ƒn-khai-code">Triá»ƒn Khai Code</a></li>
      </ul>
    </li>
    <li><a href="#chi-tiáº¿t-cáº¥u-hÃ¬nh-chÃ­nh">Chi Tiáº¿t Cáº¥u HÃ¬nh ChÃ­nh</a>
      <ul>
        <li><a href="#1-shared-dependencies-layer">1. Shared Dependencies Layer</a></li>
        <li><a href="#2-api-gateway-custom-domain">2. API Gateway Custom Domain</a></li>
        <li><a href="#3-request-validation">3. Request Validation</a></li>
        <li><a href="#4-quy-Æ°á»›c-Ä‘áº·t-tÃªn-resource">4. Quy Æ¯á»›c Äáº·t TÃªn Resource</a></li>
        <li><a href="#5-resource-tags">5. Resource Tags</a></li>
      </ul>
    </li>
    <li><a href="#stack-outputs">Stack Outputs</a></li>
    <li><a href="#cÃ¡c-bÆ°á»›c-triá»ƒn-khai">CÃ¡c BÆ°á»›c Triá»ƒn Khai</a>
      <ul>
        <li><a href="#bÆ°á»›c-1-xem-láº¡i-cáº¥u-hÃ¬nh">BÆ°á»›c 1: Xem Láº¡i Cáº¥u HÃ¬nh</a></li>
        <li><a href="#bÆ°á»›c-2-chuáº©n-bá»‹-lambda-deployment-packages">BÆ°á»›c 2: Chuáº©n Bá»‹ Lambda Deployment Packages</a></li>
        <li><a href="#bÆ°á»›c-3-synthesize-cloudformation-template">BÆ°á»›c 3: Synthesize CloudFormation Template</a></li>
        <li><a href="#bÆ°á»›c-4-triá»ƒn-khai-backend-stack">BÆ°á»›c 4: Triá»ƒn Khai Backend Stack</a></li>
        <li><a href="#bÆ°á»›c-5-xÃ¡c-minh-triá»ƒn-khai-trÃªn-aws-console">BÆ°á»›c 5: XÃ¡c Minh Triá»ƒn Khai trÃªn AWS Console</a></li>
        <li><a href="#bÆ°á»›c-6-kiá»ƒm-tra-api-endpoint">BÆ°á»›c 6: Kiá»ƒm Tra API Endpoint</a></li>
      </ul>
    </li>
    <li><a href="#sá»±-khÃ¡c-biá»‡t-giá»¯a-cÃ¡c-environment">Sá»± KhÃ¡c Biá»‡t Giá»¯a CÃ¡c Environment</a>
      <ul>
        <li><a href="#domain-names">Domain Names</a></li>
        <li><a href="#resource-naming">Resource Naming</a></li>
        <li><a href="#sá»±-khÃ¡c-biá»‡t-cáº¥u-hÃ¬nh">Sá»± KhÃ¡c Biá»‡t Cáº¥u HÃ¬nh</a></li>
        <li><a href="#lá»‡nh-triá»ƒn-khai">Lá»‡nh Triá»ƒn Khai</a></li>
        <li><a href="#cÃ¢n-nháº¯c-Ä‘áº·c-thÃ¹-cho-tá»«ng-environment">CÃ¢n Nháº¯c Äáº·c ThÃ¹ Cho Tá»«ng Environment</a></li>
      </ul>
    </li>
    <li><a href="#phÃ¢n-tÃ­ch-chi-phÃ­">PhÃ¢n TÃ­ch Chi PhÃ­</a>
      <ul>
        <li><a href="#phÃ¢n-tÃ­ch-chi-phÃ­-hÃ ng-thÃ¡ng-dev-environment">PhÃ¢n TÃ­ch Chi PhÃ­ HÃ ng ThÃ¡ng (Dev Environment)</a></li>
        <li><a href="#Æ°á»›c-tÃ­nh-chi-phÃ­-production">Æ¯á»›c TÃ­nh Chi PhÃ­ Production</a></li>
      </ul>
    </li>
    <li><a href="#cÃ¡c-bÆ°á»›c-tiáº¿p-theo">CÃ¡c BÆ°á»›c Tiáº¿p Theo</a></li>
    <li><a href="#tÃ i-liá»‡u-tham-kháº£o">TÃ i Liá»‡u Tham Kháº£o</a>
      <ul>
        <li><a href="#infrastructure-code">Infrastructure Code</a></li>
        <li><a href="#lambda-function-source-code-6-business-functions">Lambda Function Source Code (6 Business Functions)</a></li>
        <li><a href="#worker-lambda-source-code-2-active-workers">Worker Lambda Source Code (2 Active Workers)</a></li>
        <li><a href="#shared-dependencies">Shared Dependencies</a></li>
        <li><a href="#other-services-khÃ´ng-trong-backend-stack">Other Services (KhÃ´ng trong Backend Stack)</a></li>
      </ul>
    </li>
    <li><a href="#tÃ³m-táº¯t">TÃ³m Táº¯t</a>
      <ul>
        <li><a href="#development-environment-checklist">Development Environment Checklist</a></li>
        <li><a href="#cho-stagingproduction-deployment">Cho Staging/Production Deployment</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              5.4.5 Backend Stack
            </h1>
          

        



	<hr>
<h1 id="backend-stack---application-layer">Backend Stack - Application Layer</h1>
<h2 id="tá»•ng-quan">Tá»•ng Quan</h2>
<p>Backend Stack lÃ  <strong>táº§ng á»©ng dá»¥ng Phase 4</strong> cá»§a háº¡ táº§ng EveryoneCook. NÃ³ tá»•ng há»£p API Gateway, Lambda functions, SQS queues vÃ  báº£o máº­t WAF thÃ nh má»™t kiáº¿n trÃºc backend thá»‘ng nháº¥t.</p>
<p><strong>Thá»© Tá»± Triá»ƒn Khai</strong>: Stack nÃ y <strong>Báº®T BUá»˜C</strong> pháº£i Ä‘Æ°á»£c triá»ƒn khai sau Core Stack vÃ  Auth Stack.</p>
<p>âš ï¸ <strong>LÆ°u Ã Environment</strong>: HÆ°á»›ng dáº«n nÃ y táº­p trung vÃ o triá»ƒn khai mÃ´i trÆ°á»ng <strong>Development (dev)</strong>. Äá»ƒ triá»ƒn khai staging/production, xem pháº§n <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.5-backend-stack/#s%e1%bb%b1-kh%c3%a1c-bi%e1%bb%87t-gi%e1%bb%afa-c%c3%a1c-environment">Sá»± KhÃ¡c Biá»‡t Giá»¯a CÃ¡c Environment</a>.</p>
<h3 id="trÃ¡ch-nhiá»‡m-chÃ­nh">TrÃ¡ch Nhiá»‡m ChÃ­nh</h3>
<ul>
<li>Táº¡o API Gateway REST API vá»›i custom domain</li>
<li>Triá»ƒn khai <strong>6 Lambda functions</strong> (API Router + 5 business modules)</li>
<li>Cáº¥u hÃ¬nh <strong>2 SQS queues hoáº¡t Ä‘á»™ng</strong> cho async processing (AI, Image queues vá»›i DLQs)</li>
<li>Triá»ƒn khai <strong>2 worker Lambda functions</strong> cho event processing (AI Worker, Image Worker)</li>
<li>Thiáº¿t láº­p WAF Web ACL Ä‘á»ƒ báº£o vá»‡ API Gateway</li>
<li>Cáº¥u hÃ¬nh CloudWatch monitoring vÃ  alarms</li>
</ul>
<p><strong>Nhá»¯ng GÃ¬ Thá»±c Sá»± Äang Cháº¡y</strong>:</p>
<ul>
<li>8 Lambda Functions (6 business + 2 workers)</li>
<li>4 SQS Queues Ä‘Æ°á»£c triá»ƒn khai (AI + Image queues vá»›i DLQs cá»§a chÃºng)</li>
<li>1 WAF Web ACL vá»›i 5 quy táº¯c báº£o máº­t</li>
<li>CloudWatch Logs vÃ  Alarms</li>
</ul>
<h3 id="nhá»¯ng-gÃ¬-stack-nÃ y-bao-gá»“m">Nhá»¯ng GÃ¬ Stack NÃ y Bao Gá»“m</h3>
<p><strong>API Gateway</strong> (Dev Environment):</p>
<ul>
<li>Custom domain: <code>api-dev.everyonecook.cloud</code></li>
<li>ACM certificate cho HTTPS (Regional - ap-southeast-1)</li>
<li>Cognito authorizer cho JWT validation</li>
<li>Caching: <strong>Táº¯t</strong> (chá»‰ báº­t trong production)</li>
<li>Compression: <strong>Báº­t</strong> (gzip/deflate cho responses &gt;1KB)</li>
<li>Rate limiting: 10K req/sec, burst 5K</li>
<li>Request validation: Body, parameters, headers</li>
<li>Data trace logging: <strong>Báº­t</strong> (táº¯t trong production)</li>
</ul>
<p><strong>Lambda Functions (6 functions - Dev Environment)</strong>:</p>
<ol>
<li><strong>API Router</strong> (<code>everyonecook-dev-api-router</code>): Äá»‹nh tuyáº¿n requests Ä‘áº¿n target Lambda functions</li>
<li><strong>Auth &amp; User</strong> (<code>everyonecook-dev-auth-user</code>): XÃ¡c thá»±c, user profiles, privacy settings</li>
<li><strong>Social</strong> (<code>everyonecook-dev-social</code>): Posts, comments, reactions, friends, notifications</li>
<li><strong>Recipe &amp; AI</strong> (<code>everyonecook-dev-recipe-ai</code>): Recipe CRUD, AI generation, search, trending</li>
<li><strong>Admin</strong> (<code>everyonecook-dev-admin</code>): Content moderation, user management, appeals</li>
<li><strong>Upload</strong> (<code>everyonecook-dev-upload</code>): S3 presigned URLs, file uploads</li>
</ol>
<p><strong>Source Code</strong>: Táº¥t cáº£ functions náº±m trong thÆ° má»¥c <code>services/</code></p>
<p><strong>SQS Queues (2 queues hoáº¡t Ä‘á»™ng + 2 DLQs)</strong>:</p>
<ol>
<li><strong>AI Queue</strong> (<code>everyonecook-dev-ai-queue</code>): Bedrock AI recipe generation (2-minute timeout) â†’ AI Worker</li>
<li><strong>Image Queue</strong> (<code>everyonecook-dev-image-queue</code>): S3 image optimization (60-second timeout) â†’ Image Worker</li>
</ol>
<p><strong>LÆ°u Ã½</strong>: Analytics vÃ  Notification queues Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong code nhÆ°ng KHÃ”NG Ä‘Æ°á»£c triá»ƒn khai. Notifications Ä‘Æ°á»£c xá»­ lÃ½ trá»±c tiáº¿p trong Social Module.</p>
<p><strong>Worker Lambda Functions (2 workers Ä‘Æ°á»£c triá»ƒn khai hoáº¡t Ä‘á»™ng)</strong>:</p>
<ol>
<li><strong>AI Worker</strong> (<code>ai-module/workers/</code>): Xá»­ lÃ½ cÃ¡c cÃ´ng viá»‡c AI generation tá»« AI Queue sá»­ dá»¥ng Bedrock Claude 3 Haiku</li>
<li><strong>Image Worker</strong> (<code>image-worker/</code>): Xá»­ lÃ½ tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh tá»« Image Queue (resize, compress, watermark)</li>
</ol>
<p><strong>WAF Web ACL</strong>:</p>
<ul>
<li>Rate limiting: 2000 req/5min má»—i IP</li>
<li>SQL injection protection (AWS Managed)</li>
<li>XSS protection (AWS Managed)</li>
<li>Known bad inputs (AWS Managed)</li>
<li>Request size limit: 10MB tá»‘i Ä‘a</li>
</ul>
<hr>
<h2 id="kiáº¿n-trÃºc">Kiáº¿n TrÃºc</h2>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend Stack (Phase 4 - Dev Environment)                â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  WAF Web ACL (REGIONAL) - Báº£o vá»‡ API Gateway                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Rate Limiting: 2000 req/5min má»—i IP                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ SQL Injection Protection (AWS Managed)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ XSS Protection (AWS Managed)                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ Known Bad Inputs (AWS Managed)                             â”‚ â”‚
â”‚  â”‚  â””â”€ Request Size Limit: 10MB tá»‘i Ä‘a                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                            â”‚
â”‚                          â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  API Gateway REST API                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ Custom Domain: api.everyonecook.cloud                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ ACM Certificate (Regional - ap-southeast-1)                â”‚ â”‚
â”‚  â”‚  â”œâ”€ Cognito Authorizer (JWT validation)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Caching: 0.5GB, 5-min TTL (chá»‰ prod)                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Compression: gzip/deflate (&gt;1KB)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Rate Limiting: 10K req/sec, burst 5K                       â”‚ â”‚
â”‚  â”‚  â””â”€ Request Validation: Body, params, headers                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                            â”‚
â”‚                          â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Lambda Function: API Router (512MB, 30s timeout)               â”‚ â”‚
â”‚  â”‚  â”œâ”€ JWT Validation &amp; User Context Extraction                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Request Routing Ä‘áº¿n Target Lambda Functions                â”‚ â”‚
â”‚  â”‚  â””â”€ Error Handling &amp; Response Formatting                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚         â–¼                â–¼                â–¼                  â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Auth &amp;  â”‚      â”‚ Social  â”‚      â”‚ Recipe  â”‚      â”‚ Admin   â”‚    â”‚
â”‚  â”‚ User    â”‚      â”‚ Module  â”‚      â”‚ &amp; AI    â”‚      â”‚ Module  â”‚    â”‚
â”‚  â”‚ Lambda  â”‚      â”‚ Lambda  â”‚      â”‚ Lambda  â”‚      â”‚ Lambda  â”‚    â”‚
â”‚  â”‚ (512MB) â”‚      â”‚ (512MB) â”‚      â”‚ (512MB) â”‚      â”‚ (512MB) â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                â”‚                          â”‚
â”‚                          â–¼                â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SQS Queues + Worker Lambdas                                    â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  1ï¸âƒ£ AI Queue â†’ AI Worker (1024MB, 60s)                          â”‚ â”‚
â”‚  â”‚     â”œâ”€ Bedrock Claude 3 Haiku (us-east-1)                      â”‚ â”‚
â”‚  â”‚     â”œâ”€ Táº¡o recipe tá»« ingredients                               â”‚ â”‚
â”‚  â”‚     â””â”€ Visibility timeout: 2 phÃºt                              â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  2ï¸âƒ£ Image Queue â†’ Image Worker (512MB, 60s)                     â”‚ â”‚
â”‚  â”‚     â”œâ”€ Tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh S3                                  â”‚ â”‚
â”‚  â”‚     â”œâ”€ Resize, compress, watermark                             â”‚ â”‚
â”‚  â”‚     â””â”€ Visibility timeout: 60 giÃ¢y                             â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Chá»‰ 2 queues Ä‘Æ°á»£c sá»­ dá»¥ng tÃ­ch cá»±c (AI &amp; Image)           â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Analytics &amp; Notification queues tá»“n táº¡i nhÆ°ng khÃ´ng cÃ³ workers â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Táº¥t cáº£ queues cÃ³ DLQ (14-day retention)                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Dependencies tá»« CÃ¡c Stack KhÃ¡c:                                     â”‚
â”‚  â”œâ”€ DynamoDB Table (Core Stack)                                     â”‚
â”‚  â”œâ”€ S3 Content Bucket (Core Stack)                                  â”‚
â”‚  â”œâ”€ CloudFront Distribution (Core Stack)                            â”‚
â”‚  â”œâ”€ Cognito User Pool (Auth Stack)                                  â”‚
â”‚  â””â”€ Cognito User Pool Client (Auth Stack)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><hr>
<h2 id="cáº¥u-hÃ¬nh-stack">Cáº¥u HÃ¬nh Stack</h2>
<h3 id="cáº¥u-trÃºc-file">Cáº¥u TrÃºc File</h3>
<pre tabindex="0"><code>infrastructure/lib/stacks/
â””â”€â”€ backend-stack.ts          # Backend Stack implementation (2965 dÃ²ng)
    â”œâ”€ API Gateway configuration
    â”œâ”€ Lambda function definitions (6 functions)
    â”œâ”€ SQS queue configuration (4 queues + 4 DLQs)
    â”œâ”€ Worker Lambda definitions (2 workers hoáº¡t Ä‘á»™ng)
    â””â”€ WAF Web ACL configuration

services/                     # Lambda function source code
â”œâ”€â”€ api-router/               # API Router Lambda
â”œâ”€â”€ auth-module/              # Auth &amp; User Lambda
â”œâ”€â”€ social-module/            # Social Lambda
â”œâ”€â”€ recipe-module/            # Recipe &amp; AI Lambda
â”œâ”€â”€ admin-module/             # Admin Lambda
â”œâ”€â”€ upload-module/            # Upload Lambda
â”œâ”€â”€ ai-module/                # AI Worker Lambda
â”‚   â””â”€â”€ workers/
â”œâ”€â”€ image-worker/             # Image Worker Lambda
â”œâ”€â”€ websocket-module/         # WebSocket (stack riÃªng, khÃ´ng trong Backend)
â””â”€â”€ shared/                   # Shared utilities
</code></pre><h3 id="triá»ƒn-khai-code">Triá»ƒn Khai Code</h3>
<p><strong>File</strong>: <code>infrastructure/lib/stacks/backend-stack.ts</code></p>
<h4 id="1-stack-interface--constructor">1. Stack Interface &amp; Constructor</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BackendStackProps</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">BaseStackProps</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">dynamoTable</span>: <span style="color:#66d9ef">cdk.aws_dynamodb.ITable</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">contentBucket</span>: <span style="color:#66d9ef">cdk.aws_s3.IBucket</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">distribution</span>: <span style="color:#66d9ef">cdk.aws_cloudfront.IDistribution</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">userPool</span>: <span style="color:#66d9ef">cdk.aws_cognito.IUserPool</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">userPoolClient</span>: <span style="color:#66d9ef">cdk.aws_cognito.IUserPoolClient</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BackendStack</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">BaseStack</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Lambda Layer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">sharedLayer</span>: <span style="color:#66d9ef">SharedDependenciesLayer</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// API Gateway
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">api</span>: <span style="color:#66d9ef">cdk.aws_apigateway.RestApi</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">cognitoAuthorizer</span>: <span style="color:#66d9ef">cdk.aws_apigateway.CognitoUserPoolsAuthorizer</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">apiDomainName</span>: <span style="color:#66d9ef">cdk.aws_apigateway.DomainName</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Request Validators
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">bodyValidator</span>: <span style="color:#66d9ef">cdk.aws_apigateway.RequestValidator</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">paramsValidator</span>: <span style="color:#66d9ef">cdk.aws_apigateway.RequestValidator</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">fullValidator</span>: <span style="color:#66d9ef">cdk.aws_apigateway.RequestValidator</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Lambda Functions (6 business functions)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">apiRouterFunction</span>: <span style="color:#66d9ef">cdk.aws_lambda.Function</span>;    <span style="color:#75715e">// services/api-router
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">authUserFunction</span>: <span style="color:#66d9ef">cdk.aws_lambda.Function</span>;     <span style="color:#75715e">// services/auth-module
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">socialFunction</span>: <span style="color:#66d9ef">cdk.aws_lambda.Function</span>;       <span style="color:#75715e">// services/social-module
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">recipeAIFunction</span>: <span style="color:#66d9ef">cdk.aws_lambda.Function</span>;     <span style="color:#75715e">// services/recipe-module
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">adminFunction</span>: <span style="color:#66d9ef">cdk.aws_lambda.Function</span>;        <span style="color:#75715e">// services/admin-module
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">uploadFunction</span>: <span style="color:#66d9ef">cdk.aws_lambda.Function</span>;       <span style="color:#75715e">// services/upload-module
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// SQS Queues (4 queues + 4 DLQs)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">aiQueue</span>: <span style="color:#66d9ef">cdk.aws_sqs.Queue</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">imageProcessingQueue</span>: <span style="color:#66d9ef">cdk.aws_sqs.Queue</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">analyticsQueue</span>: <span style="color:#66d9ef">cdk.aws_sqs.Queue</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">notificationQueue</span>: <span style="color:#66d9ef">cdk.aws_sqs.Queue</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Worker Lambdas (2 workers hoáº¡t Ä‘á»™ng)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">aiWorker</span>: <span style="color:#66d9ef">cdk.aws_lambda.Function</span>;             <span style="color:#75715e">// services/ai-module/workers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">imageWorker?</span>: <span style="color:#66d9ef">cdk.aws_lambda.Function</span>;         <span style="color:#75715e">// services/image-worker
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// LÆ°u Ã½: analyticsWorker &amp; notificationWorker tá»“n táº¡i trong code nhÆ°ng KHÃ”NG triá»ƒn khai
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// public readonly analyticsWorker?: cdk.aws_lambda.Function;  // ÄÃ£ comment out
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// public readonly notificationWorker?: cdk.aws_lambda.Function; // KhÃ´ng Ä‘Æ°á»£c táº¡o
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// WAF WebACL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">apiGatewayWebAcl?</span>: <span style="color:#66d9ef">cdk.aws_wafv2.CfnWebACL</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">scope</span>: <span style="color:#66d9ef">Construct</span>, <span style="color:#a6e22e">id</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">BackendStackProps</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">super</span>(<span style="color:#a6e22e">scope</span>, <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">props</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ThÃªm cÃ¡c tag Ä‘áº·c thÃ¹ cho stack
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">Tags</span>.<span style="color:#66d9ef">of</span>(<span style="color:#66d9ef">this</span>).<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;StackType&#39;</span>, <span style="color:#e6db74">&#39;Backend&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">Tags</span>.<span style="color:#66d9ef">of</span>(<span style="color:#66d9ef">this</span>).<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;Layer&#39;</span>, <span style="color:#e6db74">&#39;Application&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">Tags</span>.<span style="color:#66d9ef">of</span>(<span style="color:#66d9ef">this</span>).<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;CostCenter&#39;</span>, <span style="color:#e6db74">`Backend-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Táº¡o resources (xem implementation bÃªn dÆ°á»›i)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 1. Shared Dependencies Layer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 2. SQS Queues vÃ  DLQs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 3. API Gateway
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 4. Lambda Functions
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 5. Worker Lambdas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 6. WAF Web ACL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 7. Export outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="2-cáº¥u-hÃ¬nh-api-gateway">2. Cáº¥u HÃ¬nh API Gateway</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">createAPIGateway</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">RestApi</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cachingEnabled</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">apiGateway</span>.<span style="color:#a6e22e">caching</span>.<span style="color:#a6e22e">enabled</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">compressionEnabled</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">apiGateway</span>.<span style="color:#a6e22e">compression</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">api</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">RestApi</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;EveryoneCookAPI&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">restApiName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`EveryoneCook-API-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Everyone Cook REST API - </span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Compression cho responses &gt;1KB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">minCompressionSize</span>: <span style="color:#66d9ef">compressionEnabled</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">Size</span>.<span style="color:#a6e22e">kibibytes</span>(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">deployOptions</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">stageName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;api&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Cáº¥u hÃ¬nh caching (chá»‰ production)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">cachingEnabled</span>: <span style="color:#66d9ef">cachingEnabled</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">cacheClusterEnabled</span>: <span style="color:#66d9ef">cachingEnabled</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">cacheClusterSize</span>: <span style="color:#66d9ef">cachingEnabled</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config.apiGateway.caching.cacheSize</span> : <span style="color:#66d9ef">undefined</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">cacheTtl</span>: <span style="color:#66d9ef">cachingEnabled</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">Duration</span>.<span style="color:#a6e22e">seconds</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">apiGateway</span>.<span style="color:#a6e22e">caching</span>.<span style="color:#a6e22e">ttl</span>) <span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">cacheDataEncrypted</span>: <span style="color:#66d9ef">cachingEnabled</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Throttling settings
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">throttlingRateLimit</span>: <span style="color:#66d9ef">this.config.apiGateway.throttling.rateLimit</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">throttlingBurstLimit</span>: <span style="color:#66d9ef">this.config.apiGateway.throttling.burstLimit</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// X-Ray Tracing - Táº¯t (CloudWatch Logs Ä‘á»§ dÃ¹ng)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">tracingEnabled</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Cáº¥u hÃ¬nh logging
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">loggingLevel</span>: <span style="color:#66d9ef">cdk.aws_apigateway.MethodLoggingLevel.INFO</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">dataTraceEnabled</span>: <span style="color:#66d9ef">this.config.environment</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;prod&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">metricsEnabled</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Access logging
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">accessLogDestination</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">LogGroupLogDestination</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_logs</span>.<span style="color:#a6e22e">LogGroup</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;APIGatewayAccessLogs&#39;</span>, {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">logGroupName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`/aws/apigateway/everyonecook-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">retention</span>: <span style="color:#66d9ef">this.config.cloudwatch.logRetentionDays</span>,
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>      ),
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Cáº¥u hÃ¬nh CORS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">defaultCorsPreflightOptions</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowOrigins</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`https://</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">domains</span>.<span style="color:#a6e22e">frontend</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`https://www.</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">domains</span>.<span style="color:#a6e22e">frontend</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>        ...(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;prod&#39;</span> <span style="color:#f92672">?</span> [<span style="color:#e6db74">&#39;http://localhost:3000&#39;</span>] <span style="color:#f92672">:</span> []),
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowMethods</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;POST&#39;</span>, <span style="color:#e6db74">&#39;PUT&#39;</span>, <span style="color:#e6db74">&#39;DELETE&#39;</span>, <span style="color:#e6db74">&#39;PATCH&#39;</span>, <span style="color:#e6db74">&#39;OPTIONS&#39;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowHeaders</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Authorization&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;X-Amz-Date&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;X-Api-Key&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;X-Amz-Security-Token&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;X-Correlation-Id&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Cache-Control&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Accept-Encoding&#39;</span>,
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowCredentials</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">maxAge</span>: <span style="color:#66d9ef">cdk.Duration.hours</span>(<span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Cáº¥u hÃ¬nh endpoint
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">endpointConfiguration</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">types</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">EndpointType</span>.<span style="color:#a6e22e">REGIONAL</span>],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Binary media types
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">binaryMediaTypes</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;image/*&#39;</span>, <span style="color:#e6db74">&#39;application/octet-stream&#39;</span>],
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ThÃªm Gateway Responses vá»›i CORS headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">corsHeaders</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;gatewayresponse.header.Access-Control-Allow-Origin&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#39;*&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;gatewayresponse.header.Access-Control-Allow-Headers&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#39;Content-Type,Authorization,...&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;gatewayresponse.header.Access-Control-Allow-Methods&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#39;GET,POST,PUT,DELETE,PATCH,OPTIONS&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">addGatewayResponse</span>(<span style="color:#e6db74">&#39;Unauthorized&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">ResponseType</span>.<span style="color:#a6e22e">UNAUTHORIZED</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">statusCode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;401&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">responseHeaders</span>: <span style="color:#66d9ef">corsHeaders</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">api</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="3-cáº¥u-hÃ¬nh-sqs-queue">3. Cáº¥u HÃ¬nh SQS Queue</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">createAIQueue</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_sqs</span>.<span style="color:#a6e22e">Queue</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">queue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_sqs</span>.<span style="color:#a6e22e">Queue</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;AIQueue&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">queueName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`everyonecook-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-ai-queue`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">visibilityTimeout</span>: <span style="color:#66d9ef">cdk.Duration.seconds</span>(<span style="color:#ae81ff">120</span>), <span style="color:#75715e">// 2 phÃºt cho AI processing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">retentionPeriod</span>: <span style="color:#66d9ef">cdk.Duration.days</span>(<span style="color:#ae81ff">4</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">deadLetterQueue</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">queue</span>: <span style="color:#66d9ef">this.aiDLQ</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">maxReceiveCount</span>: <span style="color:#66d9ef">3</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">encryption</span>: <span style="color:#66d9ef">cdk.aws_sqs.QueueEncryption.KMS_MANAGED</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// CloudWatch alarm cho queue depth
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">cloudwatch</span>.<span style="color:#a6e22e">alarms</span>.<span style="color:#a6e22e">enabled</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_cloudwatch</span>.<span style="color:#a6e22e">Alarm</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;AIQueueDepthAlarm&#39;</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">alarmName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`EveryoneCook-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-AI-Queue-Depth`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">metric</span>: <span style="color:#66d9ef">queue.metricApproximateNumberOfMessagesVisible</span>(),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">threshold</span>: <span style="color:#66d9ef">100</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">evaluationPeriods</span>: <span style="color:#66d9ef">2</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">queue</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="4-cáº¥u-hÃ¬nh-lambda-function">4. Cáº¥u HÃ¬nh Lambda Function</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">createAuthUserLambda</span>(<span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">BackendStackProps</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_lambda</span>.Function {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">logGroup</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_logs</span>.<span style="color:#a6e22e">LogGroup</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;AuthUserLogGroup&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logGroupName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`/aws/lambda/everyonecook-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-auth-user`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">retention</span>: <span style="color:#66d9ef">this.config.cloudwatch.logRetentionDays</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">authUserFunction</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_lambda</span>.Function(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;AuthUserFunction&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">functionName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`everyonecook-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-auth-user`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>: <span style="color:#66d9ef">cdk.aws_lambda.Runtime.NODEJS_20_X</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">handler</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;services/auth-module/index.handler&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">code</span>: <span style="color:#66d9ef">this.createLambdaCode</span>(<span style="color:#e6db74">&#39;services/auth-module/deployment&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">layers</span><span style="color:#f92672">:</span> [<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">sharedLayer</span>.<span style="color:#a6e22e">layer</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memorySize</span>: <span style="color:#66d9ef">512</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">timeout</span>: <span style="color:#66d9ef">cdk.Duration.seconds</span>(<span style="color:#ae81ff">30</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tracing</span>: <span style="color:#66d9ef">cdk.aws_lambda.Tracing.DISABLED</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">environment</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">DYNAMODB_TABLE</span>: <span style="color:#66d9ef">props.dynamoTable.tableName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">USER_POOL_ID</span>: <span style="color:#66d9ef">props.userPool.userPoolId</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">USER_POOL_CLIENT_ID</span>: <span style="color:#66d9ef">props.userPoolClient.userPoolClientId</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">CONTENT_BUCKET</span>: <span style="color:#66d9ef">props.contentBucket.bucketName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">LOG_LEVEL</span>: <span style="color:#66d9ef">this.config.environment</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;prod&#39;</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;INFO&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;DEBUG&#39;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logGroup</span>: <span style="color:#66d9ef">logGroup</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Cáº¥p permissions
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">dynamoTable</span>.<span style="color:#a6e22e">grantReadWriteData</span>(<span style="color:#a6e22e">authUserFunction</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">contentBucket</span>.<span style="color:#a6e22e">grantReadWrite</span>(<span style="color:#a6e22e">authUserFunction</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">userPool</span>.<span style="color:#a6e22e">grant</span>(<span style="color:#a6e22e">authUserFunction</span>, <span style="color:#e6db74">&#39;cognito-idp:AdminGetUser&#39;</span>, <span style="color:#e6db74">&#39;cognito-idp:ListUsers&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">authUserFunction</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="5-cáº¥u-hÃ¬nh-waf-web-acl">5. Cáº¥u HÃ¬nh WAF Web ACL</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">createApiGatewayWebAcl</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_wafv2</span>.<span style="color:#a6e22e">CfnWebACL</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">webAcl</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_wafv2</span>.<span style="color:#a6e22e">CfnWebACL</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;ApiGatewayWebACL&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`EveryoneCook-API-WAF-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;REGIONAL&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">defaultAction</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">allow</span><span style="color:#f92672">:</span> {} },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">visibilityConfig</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">sampledRequestsEnabled</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">cloudWatchMetricsEnabled</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">metricName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`EveryoneCook-API-WAF-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rules</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Rule 1: Rate Limiting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;RateLimitRule&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">priority</span>: <span style="color:#66d9ef">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">statement</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">rateBasedStatement</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">limit</span>: <span style="color:#66d9ef">2000</span>, <span style="color:#75715e">// 2000 requests má»—i 5 phÃºt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">aggregateKeyType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;IP&#39;</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">action</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">block</span><span style="color:#f92672">:</span> {} },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">visibilityConfig</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">sampledRequestsEnabled</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">cloudWatchMetricsEnabled</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">metricName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;RateLimitRule&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Rule 2-5: AWS Managed Rules (SQL injection, XSS, v.v.)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// ... xem full implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ],
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">webAcl</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="chi-tiáº¿t-cáº¥u-hÃ¬nh-chÃ­nh">Chi Tiáº¿t Cáº¥u HÃ¬nh ChÃ­nh</h2>
<h3 id="1-shared-dependencies-layer">1. Shared Dependencies Layer</h3>
<p>Backend Stack sá»­ dá»¥ng Lambda Layer Ä‘á»ƒ chia sáº» common dependencies giá»¯a táº¥t cáº£ Lambda functions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// Táº¡o Shared Dependencies Layer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">sharedLayer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SharedDependenciesLayer</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;SharedDependenciesLayer&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Lá»£i Ã­ch:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Giáº£m 90% kÃ­ch thÆ°á»›c deployment (8MB â†’ 200KB má»—i Lambda)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Triá»ƒn khai nhanh hÆ¡n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - PhiÃªn báº£n dependency nháº¥t quÃ¡n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Chi phÃ­ lÆ°u trá»¯ tháº¥p hÆ¡n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Dependencies bao gá»“m:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - AWS SDK v3 clients (DynamoDB, Lambda, Cognito, S3, SQS, Bedrock)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - uuid, jsonwebtoken, jwks-rsa
</span></span></span></code></pre></div><h3 id="2-api-gateway-custom-domain">2. API Gateway Custom Domain</h3>
<p>Stack táº¡o custom domain cho API Gateway vá»›i ACM certificate:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// Cáº¥u hÃ¬nh custom domain
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">domainName</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">domains</span>.<span style="color:#a6e22e">api</span>; <span style="color:#75715e">// api.everyonecook.cloud
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Táº¡o ACM certificate trong ap-southeast-1 (Regional endpoint)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">certificate</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">acm</span>.<span style="color:#a6e22e">Certificate</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;ApiGatewayCertificate&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">domainName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;*.everyonecook.cloud&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">validation</span>: <span style="color:#66d9ef">acm.CertificateValidation.fromDns</span>(<span style="color:#a6e22e">hostedZone</span>),
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Táº¡o API Gateway DomainName
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiDomainName</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">DomainName</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;ApiDomain&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">domainName</span>: <span style="color:#66d9ef">this.config.domains.api</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">certificate</span>: <span style="color:#66d9ef">certificate</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">endpointType</span>: <span style="color:#66d9ef">cdk.aws_apigateway.EndpointType.REGIONAL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">securityPolicy</span>: <span style="color:#66d9ef">cdk.aws_apigateway.SecurityPolicy.TLS_1_2</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Táº¡o Route 53 A record (Alias)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_route53</span>.<span style="color:#a6e22e">ARecord</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;ApiAliasRecord&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">zone</span>: <span style="color:#66d9ef">hostedZone</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">recordName</span>: <span style="color:#66d9ef">this.config.domains.api</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">target</span>: <span style="color:#66d9ef">cdk.aws_route53.RecordTarget.fromAlias</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_route53_targets</span>.<span style="color:#a6e22e">ApiGatewayDomain</span>(<span style="color:#a6e22e">apiDomainName</span>)
</span></span><span style="display:flex;"><span>  ),
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p><strong>Environments</strong>:</p>
<ul>
<li><strong>Dev</strong>: <code>api-dev.everyonecook.cloud</code></li>
<li><strong>Staging</strong>: <code>api-staging.everyonecook.cloud</code></li>
<li><strong>Prod</strong>: <code>api.everyonecook.cloud</code></li>
</ul>
<h3 id="3-request-validation">3. Request Validation</h3>
<p>Stack triá»ƒn khai ba cáº¥p Ä‘á»™ request validation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// 1. Body Validator - Chá»‰ validate request body
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">bodyValidator</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">RequestValidator</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;BodyValidator&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">restApi</span>: <span style="color:#66d9ef">api</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">validateRequestBody</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">validateRequestParameters</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 2. Params Validator - Chá»‰ validate query strings vÃ  headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">paramsValidator</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">RequestValidator</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;ParamsValidator&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">restApi</span>: <span style="color:#66d9ef">api</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">validateRequestBody</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">validateRequestParameters</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 3. Full Validator - Validate cáº£ body vÃ  parameters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fullValidator</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">cdk</span>.<span style="color:#a6e22e">aws_apigateway</span>.<span style="color:#a6e22e">RequestValidator</span>(<span style="color:#66d9ef">this</span>, <span style="color:#e6db74">&#39;FullValidator&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">restApi</span>: <span style="color:#66d9ef">api</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">validateRequestBody</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">validateRequestParameters</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Lá»£i Ã­ch:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Tá»« chá»‘i sá»›m cÃ¡c request khÃ´ng há»£p lá»‡ (trÆ°á»›c khi invoke Lambda)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Tá»‘i Æ°u chi phÃ­: KhÃ´ng tÃ­nh phÃ­ Lambda cho invalid requests
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Báº£o máº­t: NgÄƒn cháº·n malformed requests
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Hiá»‡u nÄƒng: Pháº£n há»“i lá»—i nhanh hÆ¡n
</span></span></span></code></pre></div><h3 id="4-quy-Æ°á»›c-Ä‘áº·t-tÃªn-resource">4. Quy Æ¯á»›c Äáº·t TÃªn Resource</h3>
<p>Táº¥t cáº£ resources tuÃ¢n theo pattern Ä‘áº·t tÃªn nháº¥t quÃ¡n:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// Lambda function format: everyonecook-{env}-{function}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">functionName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`everyonecook-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-auth-user`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// SQS queue format: everyonecook-{env}-{queue}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">queueName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`everyonecook-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-ai-queue`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// API Gateway format: EveryoneCook-API-{env}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">restApiName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`EveryoneCook-API-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// WAF format: EveryoneCook-API-WAF-{env}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`EveryoneCook-API-WAF-</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>
</span></span></code></pre></div><p><strong>VÃ­ dá»¥</strong>:</p>
<ul>
<li>Stack name: <code>EveryoneCook-dev-Backend</code></li>
<li>API: <code>EveryoneCook-API-dev</code></li>
<li>Lambda: <code>everyonecook-dev-auth-user</code></li>
<li>Queue: <code>everyonecook-dev-ai-queue</code></li>
</ul>
<h3 id="5-resource-tags">5. Resource Tags</h3>
<p>Má»—i resource Ä‘Æ°á»£c tag Ä‘á»ƒ theo dÃµi chi phÃ­ vÃ  quáº£n lÃ½:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Stack</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;EveryoneCook-dev-Backend&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Environment</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dev&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">StackType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Backend&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Layer</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Application&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">CostCenter</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Backend-dev&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Component</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;API&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;EventProcessing&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Security&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Module</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;AuthUser&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Social&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;RecipeAI&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Admin&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Upload&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Purpose</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;REST-API&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;RequestRouting&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;AI-Processing&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Project</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;EveryoneCook&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="stack-outputs">Stack Outputs</h2>
<p>Sau khi triá»ƒn khai, stack export cÃ¡c giÃ¡ trá»‹ sau:</p>
<table>
  <thead>
      <tr>
          <th>Output Name</th>
          <th>Value</th>
          <th>Sá»­ dá»¥ng</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>ApiUrl</code></td>
          <td><code>https://api.everyonecook.cloud</code></td>
          <td>Frontend API endpoint</td>
      </tr>
      <tr>
          <td><code>ApiId</code></td>
          <td><code>abc123xyz</code></td>
          <td>API Gateway REST API ID</td>
      </tr>
      <tr>
          <td><code>ApiStage</code></td>
          <td><code>api</code></td>
          <td>API Gateway stage name</td>
      </tr>
      <tr>
          <td><code>ApiDomainName</code></td>
          <td><code>api.everyonecook.cloud</code></td>
          <td>Custom domain name</td>
      </tr>
      <tr>
          <td><code>AIQueueUrl</code></td>
          <td><code>https://sqs.ap-southeast-1...</code></td>
          <td>AI Queue URL Ä‘á»ƒ gá»­i messages</td>
      </tr>
      <tr>
          <td><code>ImageQueueUrl</code></td>
          <td><code>https://sqs.ap-southeast-1...</code></td>
          <td>Image Queue URL</td>
      </tr>
      <tr>
          <td><code>WafWebAclArn</code></td>
          <td><code>arn:aws:wafv2:...</code></td>
          <td>WAF Web ACL ARN</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="cÃ¡c-bÆ°á»›c-triá»ƒn-khai">CÃ¡c BÆ°á»›c Triá»ƒn Khai</h2>
<h3 id="bÆ°á»›c-1-xem-láº¡i-cáº¥u-hÃ¬nh">BÆ°á»›c 1: Xem Láº¡i Cáº¥u HÃ¬nh</h3>
<p>Di chuyá»ƒn Ä‘áº¿n thÆ° má»¥c infrastructure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\infrastructure
</span></span></code></pre></div><p>XÃ¡c minh cáº¥u hÃ¬nh mÃ´i trÆ°á»ng <strong>Development</strong> trong <code>config/environment.ts</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#a6e22e">dev</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">environment</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dev&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">account</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;YOUR_AWS_ACCOUNT_ID&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">region</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;ap-southeast-1&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">domains</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">frontend</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dev.everyonecook.cloud&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">api</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;api-dev.everyonecook.cloud&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cdn</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;cdn-dev.everyonecook.cloud&#39;</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">apiGateway</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">caching</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">enabled</span>: <span style="color:#66d9ef">false</span>, <span style="color:#75715e">//  Táº¯t trong dev (báº­t trong prod)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">cacheSize</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;0.5&#39;</span>, <span style="color:#75715e">// 0.5GB cache (chá»‰ prod)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">ttl</span>: <span style="color:#66d9ef">300</span>, <span style="color:#75715e">// 5 phÃºt (chá»‰ prod)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">compression</span>: <span style="color:#66d9ef">true</span>, <span style="color:#75715e">//  Báº­t trong táº¥t cáº£ environments
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">throttling</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">rateLimit</span>: <span style="color:#66d9ef">10000</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">burstLimit</span>: <span style="color:#66d9ef">5000</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cloudwatch</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logRetentionDays</span>: <span style="color:#66d9ef">7</span>, <span style="color:#75715e">// Dev: 7 ngÃ y, Staging: 30 ngÃ y, Prod: 90 ngÃ y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">alarms</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">enabled</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ... cÃ¡c configs khÃ¡c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p><strong>Cho Staging/Production</strong>: Cáº­p nháº­t tham sá»‘ <code>--context environment=</code> trong cÃ¡c lá»‡nh triá»ƒn khai.</p>
<h3 id="bÆ°á»›c-2-chuáº©n-bá»‹-lambda-deployment-packages">BÆ°á»›c 2: Chuáº©n Bá»‹ Lambda Deployment Packages</h3>
<p>TrÆ°á»›c khi triá»ƒn khai, chuáº©n bá»‹ Lambda deployment packages cho <strong>8 Lambda functions + 1 Layer</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># 1. Chuáº©n bá»‹ Shared Layer TRÆ¯á»šC TIÃŠN (báº¯t buá»™c cho táº¥t cáº£ Lambdas)</span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\layers\shared-dependencies
</span></span><span style="display:flex;"><span>.\prepare-layer.ps1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Chuáº©n bá»‹ Business Lambda Functions (6 functions)</span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\services\api-router
</span></span><span style="display:flex;"><span>.\prepare-deployment-layer.ps1  <span style="color:#75715e"># hoáº·c prepare-deployment.ps1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\services\auth-module
</span></span><span style="display:flex;"><span>.\prepare-deployment-layer.ps1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\services\social-module
</span></span><span style="display:flex;"><span>.\prepare-deployment-layer.ps1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\services\recipe-module
</span></span><span style="display:flex;"><span>.\prepare-deployment-layer.ps1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\services\admin-module
</span></span><span style="display:flex;"><span>.\prepare-deployment-layer.ps1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\services\upload-module
</span></span><span style="display:flex;"><span>.\prepare-deployment-layer.ps1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. Chuáº©n bá»‹ Worker Lambda Functions (2 workers)</span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\services\ai-module
</span></span><span style="display:flex;"><span>.\prepare-deployment.ps1  <span style="color:#75715e"># AI Worker sá»­ dá»¥ng prepare-deployment.ps1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\services\image-worker
</span></span><span style="display:flex;"><span>.\prepare-deployment-layer.ps1
</span></span></code></pre></div><p><strong>LÆ°u Ã Quan Trá»ng</strong>:</p>
<ul>
<li>Má»—i service pháº£i cÃ³ thÆ° má»¥c <code>deployment/</code> sau khi cháº¡y prepare script</li>
<li>Shared Layer pháº£i Ä‘Æ°á»£c build TRÆ¯á»šC TIÃŠN vÃ¬ táº¥t cáº£ Lambdas phá»¥ thuá»™c vÃ o nÃ³</li>
<li>Kiá»ƒm tra <code>prepare-deployment.ps1</code> hoáº·c <code>prepare-deployment-layer.ps1</code> trong má»—i service folder</li>
<li>Tá»•ng kÃ­ch thÆ°á»›c deployment: ~8MB â†’ ~200KB má»—i Lambda (nhá» Shared Layer)</li>
</ul>
<h3 id="bÆ°á»›c-3-synthesize-cloudformation-template">BÆ°á»›c 3: Synthesize CloudFormation Template</h3>
<p>Táº¡o CloudFormation template Ä‘á»ƒ xem láº¡i cÃ¡c thay Ä‘á»•i:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># Quay vá» thÆ° má»¥c infrastructure</span>
</span></span><span style="display:flex;"><span>cd D:\Project_AWS\everyonecook\infrastructure
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Synthesize template</span>
</span></span><span style="display:flex;"><span>npx cdk synth EveryoneCook-dev-Backend --context environment=dev
</span></span></code></pre></div><p>Káº¿t quáº£ mong Ä‘á»£i hiá»ƒn thá»‹ CloudFormation template vá»›i táº¥t cáº£ resources.</p>
<h3 id="bÆ°á»›c-4-triá»ƒn-khai-backend-stack">BÆ°á»›c 4: Triá»ƒn Khai Backend Stack</h3>
<p>Triá»ƒn khai Backend stack lÃªn AWS:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># Chá»‰ triá»ƒn khai Backend Stack</span>
</span></span><span style="display:flex;"><span>npx cdk deploy EveryoneCook-dev-Backend --context environment=dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Hoáº·c triá»ƒn khai vá»›i approval</span>
</span></span><span style="display:flex;"><span>npx cdk deploy EveryoneCook-dev-Backend --context environment=dev --require-approval never
</span></span></code></pre></div><p>Káº¿t quáº£ mong Ä‘á»£i:</p>
<pre tabindex="0"><code>âœ¨  Synthesis time: 5.23s

EveryoneCook-dev-Backend: deploying...
[0%] start: Publishing abc123:current_account-current_region
[33%] success: Published abc123:current_account-current_region
[33%] start: Publishing def456:current_account-current_region
[66%] success: Published def456:current_account-current_region
[66%] start: Publishing EveryoneCook-dev-Backend
[100%] success: Published EveryoneCook-dev-Backend

EveryoneCook-dev-Backend: creating CloudFormation changeset...

   EveryoneCook-dev-Backend

âœ¨  Deployment time: 420.15s

Outputs:
EveryoneCook-dev-Backend.ApiUrl = https://api-dev.everyonecook.cloud
EveryoneCook-dev-Backend.ApiId = abc123xyz
EveryoneCook-dev-Backend.ApiStage = api
EveryoneCook-dev-Backend.ApiDomainName = api-dev.everyonecook.cloud
EveryoneCook-dev-Backend.AIQueueUrl = https://sqs.ap-southeast-1.amazonaws.com/123456789/everyonecook-dev-ai-queue
EveryoneCook-dev-Backend.ImageQueueUrl = https://sqs.ap-southeast-1.amazonaws.com/123456789/everyonecook-dev-image-queue
EveryoneCook-dev-Backend.WafWebAclArn = arn:aws:wafv2:ap-southeast-1:123456789:regional/webacl/EveryoneCook-API-WAF-dev/...

Stack ARN:
arn:aws:cloudformation:ap-southeast-1:123456789:stack/EveryoneCook-dev-Backend/...

âœ¨  Total time: 425.38s
</code></pre><p><strong>Thá»i gian triá»ƒn khai</strong>: ~7 phÃºt (bao gá»“m certificate validation)</p>
<h3 id="bÆ°á»›c-5-xÃ¡c-minh-triá»ƒn-khai-trÃªn-aws-console">BÆ°á»›c 5: XÃ¡c Minh Triá»ƒn Khai trÃªn AWS Console</h3>
<h4 id="51-xÃ¡c-minh-api-gateway">5.1: XÃ¡c Minh API Gateway</h4>
<ol>
<li>Äiá»u hÆ°á»›ng Ä‘áº¿n <strong>API Gateway Console</strong></li>
<li>Chá»n region: <strong>ap-southeast-1</strong></li>
<li>Click vÃ o <strong>EveryoneCook-API-dev</strong></li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-01-api-gateway-dashboard.png" alt="API Gateway Dashboard">
<em>Dashboard API Gateway hiá»ƒn thá»‹ tÃªn API, stage, custom domain, tráº¡ng thÃ¡i caching vÃ  throttling settings</em></p>
<ol start="4">
<li>Click vÃ o <strong>Stages</strong> â†’ <strong>api</strong></li>
<li>XÃ¡c minh stage settings:
<ul>
<li>Cache Settings: Enabled (prod) / Disabled (dev)</li>
<li>Cache capacity: 0.5 GB (chá»‰ prod)</li>
<li>Default TTL: 300 seconds (chá»‰ prod)</li>
<li>Throttling: 10000 requests/sec</li>
<li>Burst: 5000 requests/sec</li>
</ul>
</li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-02-api-gateway-stage-settings.png" alt="API Gateway Stage Settings">
<em>Stage settings hiá»ƒn thá»‹ cáº¥u hÃ¬nh caching vÃ  throttling</em></p>
<ol start="6">
<li>Click vÃ o <strong>Custom domain names</strong></li>
<li>XÃ¡c minh custom domain:
<ul>
<li>Domain name: <code>api-dev.everyonecook.cloud</code></li>
<li>Certificate: ACM certificate (Regional)</li>
<li>Base path mapping: <code>/</code> â†’ <code>api</code> stage</li>
</ul>
</li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-03-api-gateway-custom-domain.png" alt="API Gateway Custom Domain">
<em>Cáº¥u hÃ¬nh custom domain vá»›i ACM certificate</em></p>
<h4 id="52-xÃ¡c-minh-lambda-functions">5.2: XÃ¡c Minh Lambda Functions</h4>
<ol>
<li>Äiá»u hÆ°á»›ng Ä‘áº¿n <strong>Lambda Console</strong></li>
<li>Chá»n region: <strong>ap-southeast-1</strong></li>
<li>XÃ¡c minh táº¥t cáº£ 8 Lambda functions tá»“n táº¡i:</li>
</ol>
<table>
  <thead>
      <tr>
          <th>TÃªn Function</th>
          <th>Runtime</th>
          <th>Memory</th>
          <th>Timeout</th>
          <th>Layer</th>
          <th>Source Code</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>everyonecook-dev-api-router</code></td>
          <td>Node 20.x</td>
          <td>512MB</td>
          <td>30s</td>
          <td>SharedDependenciesLayer</td>
          <td><code>services/api-router</code></td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-auth-user</code></td>
          <td>Node 20.x</td>
          <td>512MB</td>
          <td>30s</td>
          <td>SharedDependenciesLayer</td>
          <td><code>services/auth-module</code></td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-social</code></td>
          <td>Node 20.x</td>
          <td>512MB</td>
          <td>30s</td>
          <td>SharedDependenciesLayer</td>
          <td><code>services/social-module</code></td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-recipe-ai</code></td>
          <td>Node 20.x</td>
          <td>512MB</td>
          <td>30s</td>
          <td>SharedDependenciesLayer</td>
          <td><code>services/recipe-module</code></td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-admin</code></td>
          <td>Node 20.x</td>
          <td>512MB</td>
          <td>30s</td>
          <td>SharedDependenciesLayer</td>
          <td><code>services/admin-module</code></td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-upload</code></td>
          <td>Node 20.x</td>
          <td>512MB</td>
          <td>30s</td>
          <td>SharedDependenciesLayer</td>
          <td><code>services/upload-module</code></td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-ai-worker</code></td>
          <td>Node 20.x</td>
          <td>1024MB</td>
          <td>60s</td>
          <td>SharedDependenciesLayer</td>
          <td><code>services/ai-module/workers</code></td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-image-worker</code></td>
          <td>Node 20.x</td>
          <td>512MB</td>
          <td>60s</td>
          <td>SharedDependenciesLayer</td>
          <td><code>services/image-worker</code></td>
      </tr>
  </tbody>
</table>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/cognito-triggers.png" alt="Lambda Functions List">
<em>Danh sÃ¡ch Lambda functions hiá»ƒn thá»‹ táº¥t cáº£ 8 functions vá»›i runtime vÃ  configuration</em></p>
<ol start="4">
<li>Click vÃ o <strong>everyonecook-dev-api-router</strong></li>
<li>XÃ¡c minh configuration:
<ul>
<li>Environment variables: <code>DYNAMODB_TABLE</code>, <code>USER_POOL_ID</code>, v.v.</li>
<li>Layers: <code>SharedDependenciesLayer</code></li>
<li>Triggers: API Gateway (Proxy integration)</li>
</ul>
</li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-05-lambda-api-router-config.png" alt="Lambda API Router Configuration">
<em>API Router function hiá»ƒn thá»‹ environment variables, layers, vÃ  API Gateway trigger</em></p>
<ol start="6">
<li>Click vÃ o tab <strong>Monitoring</strong></li>
<li>XÃ¡c minh CloudWatch Logs integration:
<ul>
<li>Log group: <code>/aws/lambda/everyonecook-dev-api-router</code></li>
<li>Retention: Dá»±a trÃªn environment config</li>
</ul>
</li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-06-lambda-monitoring.png" alt="Lambda Monitoring Dashboard">
<em>Dashboard monitoring Lambda hiá»ƒn thá»‹ CloudWatch Logs vÃ  metrics</em></p>
<h4 id="53-xÃ¡c-minh-sqs-queues">5.3: XÃ¡c Minh SQS Queues</h4>
<ol>
<li>Äiá»u hÆ°á»›ng Ä‘áº¿n <strong>SQS Console</strong></li>
<li>Chá»n region: <strong>ap-southeast-1</strong></li>
<li>XÃ¡c minh 4 queues hoáº¡t Ä‘á»™ng tá»“n táº¡i (2 main + 2 DLQs):</li>
</ol>
<p><strong>LÆ°u Ã½</strong>: Chá»‰ AI vÃ  Image queues Ä‘Æ°á»£c sá»­ dá»¥ng tÃ­ch cá»±c. Analytics vÃ  Notification queues tá»“n táº¡i trong code nhÆ°ng khÃ´ng Ä‘Æ°á»£c triá»ƒn khai.</p>
<table>
  <thead>
      <tr>
          <th>TÃªn Queue</th>
          <th>Type</th>
          <th>Visibility Timeout</th>
          <th>Retention</th>
          <th>DLQ</th>
          <th>Tráº¡ng thÃ¡i Worker</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>everyonecook-dev-ai-queue</code></td>
          <td>Main</td>
          <td>2 phÃºt</td>
          <td>4 ngÃ y</td>
          <td>everyonecook-dev-ai-dlq</td>
          <td>Hoáº¡t Ä‘á»™ng</td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-ai-dlq</code></td>
          <td>DLQ</td>
          <td>5 phÃºt</td>
          <td>14 ngÃ y</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-image-queue</code></td>
          <td>Main</td>
          <td>60 giÃ¢y</td>
          <td>4 ngÃ y</td>
          <td>everyonecook-dev-image-dlq</td>
          <td>Hoáº¡t Ä‘á»™ng</td>
      </tr>
      <tr>
          <td><code>everyonecook-dev-image-dlq</code></td>
          <td>DLQ</td>
          <td>5 phÃºt</td>
          <td>14 ngÃ y</td>
          <td>-</td>
          <td>-</td>
      </tr>
  </tbody>
</table>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-07-sqs-queues-list.png" alt="SQS Queues List">
<em>Danh sÃ¡ch SQS queues hiá»ƒn thá»‹ 4 queues hoáº¡t Ä‘á»™ng: ai-queue, ai-dlq, image-queue, image-dlq</em></p>
<ol start="4">
<li>Click vÃ o <strong>everyonecook-dev-ai-queue</strong></li>
<li>XÃ¡c minh queue configuration:
<ul>
<li>Visibility timeout: 2 phÃºt</li>
<li>Message retention: 4 ngÃ y</li>
<li>Dead-letter queue: <code>everyonecook-dev-ai-dlq</code></li>
<li>Maximum receives: 3</li>
<li>Encryption: KMS managed</li>
</ul>
</li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-08-sqs-ai-queue-config.png" alt="SQS AI Queue Configuration">
<em>Cáº¥u hÃ¬nh AI Queue hiá»ƒn thá»‹ visibility timeout, retention, DLQ, vÃ  encryption settings</em></p>
<ol start="6">
<li>Click vÃ o tab <strong>Lambda triggers</strong></li>
<li>XÃ¡c minh Lambda trigger:
<ul>
<li>Function: <code>everyonecook-dev-ai-worker</code></li>
<li>Batch size: 1</li>
<li>Batch window: 0 seconds</li>
</ul>
</li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-09-sqs-ai-queue-lambda-trigger.png" alt="SQS AI Queue Lambda Trigger">
<em>AI Queue Lambda trigger hiá»ƒn thá»‹ ai-worker function vá»›i batch configuration</em></p>
<h4 id="54-xÃ¡c-minh-waf-web-acl">5.4: XÃ¡c Minh WAF Web ACL</h4>
<ol>
<li>Äiá»u hÆ°á»›ng Ä‘áº¿n <strong>WAF &amp; Shield Console</strong></li>
<li>Chá»n region: <strong>ap-southeast-1</strong> (Regional)</li>
<li>Click vÃ o <strong>Web ACLs</strong></li>
<li>Click vÃ o <strong>EveryoneCook-API-WAF-dev</strong></li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-10-waf-web-acl-dashboard.png" alt="WAF Web ACL Dashboard">
<em>Dashboard WAF Web ACL Ä‘á»ƒ báº£o vá»‡ EveryoneCook API</em></p>
<ol start="5">
<li>Click vÃ o tab <strong>Rules</strong></li>
<li>XÃ¡c minh táº¥t cáº£ 5 rules tá»“n táº¡i:</li>
</ol>
<table>
  <thead>
      <tr>
          <th>Priority</th>
          <th>TÃªn Rule</th>
          <th>Type</th>
          <th>Action</th>
          <th>Status</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>RateLimitRule</td>
          <td>Rate-based</td>
          <td>Block</td>
          <td>Enabled</td>
      </tr>
      <tr>
          <td>1</td>
          <td>AWSManagedRulesSQLi</td>
          <td>Managed</td>
          <td>Block</td>
          <td>Enabled</td>
      </tr>
      <tr>
          <td>2</td>
          <td>AWSManagedRulesKnownBadInputs</td>
          <td>Managed</td>
          <td>Block</td>
          <td>Enabled</td>
      </tr>
      <tr>
          <td>3</td>
          <td>AWSManagedRulesCoreRuleSet</td>
          <td>Managed</td>
          <td>Block</td>
          <td>Enabled</td>
      </tr>
      <tr>
          <td>4</td>
          <td>RequestSizeLimit</td>
          <td>Size constraint</td>
          <td>Block</td>
          <td>Enabled</td>
      </tr>
  </tbody>
</table>
<h4 id="55-xÃ¡c-minh-cloudwatch-alarms">5.5: XÃ¡c Minh CloudWatch Alarms</h4>
<ol>
<li>Äiá»u hÆ°á»›ng Ä‘áº¿n <strong>CloudWatch Console</strong></li>
<li>Chá»n region: <strong>ap-southeast-1</strong></li>
<li>Filter theo: <code>EveryoneCook-dev-Backend</code></li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-13-cloudwatch-alarms.png" alt="CloudWatch Alarms List">
<em>CloudWatch alarms cho Backend Stack: Queue depth, Lambda errors/duration, WAF blocks</em></p>
<h4 id="56-xÃ¡c-minh-route-53-dns-record">5.6: XÃ¡c Minh Route 53 DNS Record</h4>
<ol>
<li>Äiá»u hÆ°á»›ng Ä‘áº¿n <strong>Route 53 Console</strong></li>
<li>Click vÃ o <strong>Hosted zones</strong></li>
<li>Click vÃ o <strong>everyonecook.cloud</strong></li>
<li>XÃ¡c minh A record tá»“n táº¡i:
<ul>
<li>Name: <code>api-dev.everyonecook.cloud</code></li>
<li>Type: A (Alias)</li>
<li>Target: API Gateway domain name</li>
<li>Routing policy: Simple</li>
</ul>
</li>
</ol>
<p><img src="../../../../images/5-Workshop/5.4-configure-stacks/5.4.5-14-route53-api-record.png" alt="Route 53 API Record">
<em>Route 53 A record (Alias) trá» Ä‘áº¿n API Gateway custom domain</em></p>
<h3 id="bÆ°á»›c-6-kiá»ƒm-tra-api-endpoint">BÆ°á»›c 6: Kiá»ƒm Tra API Endpoint</h3>
<p>Kiá»ƒm tra custom domain endpoint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># Kiá»ƒm tra API Gateway health endpoint (náº¿u tá»“n táº¡i)</span>
</span></span><span style="display:flex;"><span>curl https<span style="color:#960050;background-color:#1e0010">:</span>//api-dev.everyonecook.cloud/health
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Hoáº·c kiá»ƒm tra vá»›i browser</span>
</span></span><span style="display:flex;"><span>start https<span style="color:#960050;background-color:#1e0010">:</span>//api-dev.everyonecook.cloud
</span></span></code></pre></div><p>Pháº£n há»“i mong Ä‘á»£i (náº¿u health endpoint tá»“n táº¡i):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;healthy&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;environment&#34;</span>: <span style="color:#e6db74">&#34;dev&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2024-01-15T10:30:00Z&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="sá»±-khÃ¡c-biá»‡t-giá»¯a-cÃ¡c-environment">Sá»± KhÃ¡c Biá»‡t Giá»¯a CÃ¡c Environment</h2>
<p>HÆ°á»›ng dáº«n nÃ y sá»­ dá»¥ng mÃ´i trÆ°á»ng <strong>Development (dev)</strong> lÃ m vÃ­ dá»¥. DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c khÃ¡c biá»‡t chÃ­nh giá»¯a cÃ¡c mÃ´i trÆ°á»ng:</p>
<h3 id="domain-names">Domain Names</h3>
<table>
  <thead>
      <tr>
          <th>Environment</th>
          <th>API Domain</th>
          <th>Frontend Domain</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Dev</strong></td>
          <td><code>api-dev.everyonecook.cloud</code></td>
          <td><code>dev.everyonecook.cloud</code></td>
      </tr>
      <tr>
          <td><strong>Staging</strong></td>
          <td><code>api-staging.everyonecook.cloud</code></td>
          <td><code>staging.everyonecook.cloud</code></td>
      </tr>
      <tr>
          <td><strong>Prod</strong></td>
          <td><code>api.everyonecook.cloud</code></td>
          <td><code>everyonecook.cloud</code></td>
      </tr>
  </tbody>
</table>
<h3 id="resource-naming">Resource Naming</h3>
<table>
  <thead>
      <tr>
          <th>Loáº¡i Resource</th>
          <th>Dev</th>
          <th>Staging</th>
          <th>Prod</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Stack Name</td>
          <td><code>EveryoneCook-dev-Backend</code></td>
          <td><code>EveryoneCook-staging-Backend</code></td>
          <td><code>EveryoneCook-prod-Backend</code></td>
      </tr>
      <tr>
          <td>API Gateway</td>
          <td><code>EveryoneCook-API-dev</code></td>
          <td><code>EveryoneCook-API-staging</code></td>
          <td><code>EveryoneCook-API-prod</code></td>
      </tr>
      <tr>
          <td>Lambda</td>
          <td><code>everyonecook-dev-auth-user</code></td>
          <td><code>everyonecook-staging-auth-user</code></td>
          <td><code>everyonecook-prod-auth-user</code></td>
      </tr>
      <tr>
          <td>SQS Queue</td>
          <td><code>everyonecook-dev-ai-queue</code></td>
          <td><code>everyonecook-staging-ai-queue</code></td>
          <td><code>everyonecook-prod-ai-queue</code></td>
      </tr>
      <tr>
          <td>WAF</td>
          <td><code>EveryoneCook-API-WAF-dev</code></td>
          <td><code>EveryoneCook-API-WAF-staging</code></td>
          <td><code>EveryoneCook-API-WAF-prod</code></td>
      </tr>
  </tbody>
</table>
<h3 id="sá»±-khÃ¡c-biá»‡t-cáº¥u-hÃ¬nh">Sá»± KhÃ¡c Biá»‡t Cáº¥u HÃ¬nh</h3>
<table>
  <thead>
      <tr>
          <th>Setting</th>
          <th>Dev</th>
          <th>Staging</th>
          <th>Production</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>API Caching</strong></td>
          <td>Táº¯t</td>
          <td>Táº¯t</td>
          <td>Báº­t (0.5GB)</td>
      </tr>
      <tr>
          <td><strong>Data Trace Logging</strong></td>
          <td>Báº­t</td>
          <td>Báº­t</td>
          <td>Táº¯t</td>
      </tr>
      <tr>
          <td><strong>Log Retention</strong></td>
          <td>7 ngÃ y</td>
          <td>30 ngÃ y</td>
          <td>90 ngÃ y</td>
      </tr>
      <tr>
          <td><strong>CloudWatch Removal</strong></td>
          <td>DESTROY</td>
          <td>DESTROY</td>
          <td>RETAIN</td>
      </tr>
      <tr>
          <td><strong>WAF Rate Limit</strong></td>
          <td>2000 req/5min</td>
          <td>2000 req/5min</td>
          <td>5000 req/5min</td>
      </tr>
      <tr>
          <td><strong>Lambda Log Level</strong></td>
          <td>DEBUG</td>
          <td>INFO</td>
          <td>INFO</td>
      </tr>
      <tr>
          <td><strong>CORS Localhost</strong></td>
          <td>Cho phÃ©p</td>
          <td>KhÃ´ng cho phÃ©p</td>
          <td>KhÃ´ng cho phÃ©p</td>
      </tr>
  </tbody>
</table>
<h3 id="lá»‡nh-triá»ƒn-khai">Lá»‡nh Triá»ƒn Khai</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># Development</span>
</span></span><span style="display:flex;"><span>npx cdk deploy EveryoneCook-dev-Backend --context environment=dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Staging</span>
</span></span><span style="display:flex;"><span>npx cdk deploy EveryoneCook-staging-Backend --context environment=staging
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Production (yÃªu cáº§u approval)</span>
</span></span><span style="display:flex;"><span>npx cdk deploy EveryoneCook-prod-Backend --context environment=prod --require-approval broadening
</span></span></code></pre></div><h3 id="cÃ¢n-nháº¯c-Ä‘áº·c-thÃ¹-cho-tá»«ng-environment">CÃ¢n Nháº¯c Äáº·c ThÃ¹ Cho Tá»«ng Environment</h3>
<h4 id="development">Development</h4>
<ul>
<li>CORS cho phÃ©p <code>http://localhost:3000</code> Ä‘á»ƒ kiá»ƒm tra frontend local</li>
<li>Data trace logging báº­t Ä‘á»ƒ debug</li>
<li>Log retention tháº¥p hÆ¡n (7 ngÃ y) Ä‘á»ƒ giáº£m chi phÃ­</li>
<li>Resources bá»‹ xÃ³a khi xÃ³a stack (RemovalPolicy.DESTROY)</li>
</ul>
<h4 id="staging">Staging</h4>
<ul>
<li>Cáº¥u hÃ¬nh giá»‘ng production Ä‘á»ƒ kiá»ƒm tra pre-release</li>
<li>Domain riÃªng Ä‘á»ƒ trÃ¡nh áº£nh hÆ°á»Ÿng production</li>
<li>CÃ¡c quy táº¯c báº£o máº­t giá»‘ng production</li>
<li>Resources bá»‹ xÃ³a khi xÃ³a stack</li>
</ul>
<h4 id="production">Production</h4>
<ul>
<li>API Gateway caching báº­t (0.5GB, 5-min TTL)</li>
<li>Data trace logging táº¯t (tá»‘i Æ°u chi phÃ­)</li>
<li>Log retention 90 ngÃ y Ä‘á»ƒ tuÃ¢n thá»§</li>
<li>Resources Ä‘Æ°á»£c giá»¯ láº¡i khi xÃ³a stack (RemovalPolicy.RETAIN)</li>
<li>WAF rate limits nghiÃªm ngáº·t hÆ¡n</li>
<li>KhÃ´ng cÃ³ localhost CORS</li>
</ul>
<hr>
<h2 id="phÃ¢n-tÃ­ch-chi-phÃ­">PhÃ¢n TÃ­ch Chi PhÃ­</h2>
<h3 id="phÃ¢n-tÃ­ch-chi-phÃ­-hÃ ng-thÃ¡ng-dev-environment">PhÃ¢n TÃ­ch Chi PhÃ­ HÃ ng ThÃ¡ng (Dev Environment)</h3>
<table>
  <thead>
      <tr>
          <th>Dá»‹ch vá»¥</th>
          <th>Cáº¥u hÃ¬nh</th>
          <th>Chi phÃ­ hÃ ng thÃ¡ng</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>API Gateway</td>
          <td>1M requests, caching táº¯t</td>
          <td>~$3.50</td>
      </tr>
      <tr>
          <td>Lambda (6 functions)</td>
          <td>512MB, 1M invocations, 200ms avg</td>
          <td>~$8.40</td>
      </tr>
      <tr>
          <td>Lambda (2 workers)</td>
          <td>512-1024MB, 10K invocations</td>
          <td>~$0.42</td>
      </tr>
      <tr>
          <td>SQS (2 queues)</td>
          <td>10K messages/thÃ¡ng</td>
          <td>~$0.03</td>
      </tr>
      <tr>
          <td>WAF Web ACL</td>
          <td>1 ACL + 5 rules + 1M requests</td>
          <td>~$10.60</td>
      </tr>
      <tr>
          <td>CloudWatch Logs</td>
          <td>5GB ingestion, 30-day retention</td>
          <td>~$2.50</td>
      </tr>
      <tr>
          <td>CloudWatch Alarms</td>
          <td>10 alarms</td>
          <td>~$1.00</td>
      </tr>
      <tr>
          <td><strong>Tá»•ng</strong></td>
          <td><strong>Backend Stack</strong></td>
          <td><strong>~$26.45/thÃ¡ng</strong></td>
      </tr>
  </tbody>
</table>
<h3 id="Æ°á»›c-tÃ­nh-chi-phÃ­-production">Æ¯á»›c TÃ­nh Chi PhÃ­ Production</h3>
<table>
  <thead>
      <tr>
          <th>Dá»‹ch vá»¥</th>
          <th>Cáº¥u hÃ¬nh</th>
          <th>Chi phÃ­ hÃ ng thÃ¡ng</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>API Gateway</td>
          <td>10M requests, caching báº­t (0.5GB)</td>
          <td>~$50.00</td>
      </tr>
      <tr>
          <td>Lambda (6 functions)</td>
          <td>512MB, 10M invocations, 200ms avg</td>
          <td>~$84.00</td>
      </tr>
      <tr>
          <td>Lambda (2 workers)</td>
          <td>512-1024MB, 100K invocations</td>
          <td>~$4.20</td>
      </tr>
      <tr>
          <td>SQS (2 queues)</td>
          <td>100K messages/thÃ¡ng</td>
          <td>~$0.25</td>
      </tr>
      <tr>
          <td>WAF Web ACL</td>
          <td>1 ACL + 5 rules + 10M requests</td>
          <td>~$16.00</td>
      </tr>
      <tr>
          <td>CloudWatch Logs</td>
          <td>20GB ingestion, 90-day retention</td>
          <td>~$10.00</td>
      </tr>
      <tr>
          <td>CloudWatch Alarms</td>
          <td>15 alarms</td>
          <td>~$1.50</td>
      </tr>
      <tr>
          <td><strong>Tá»•ng</strong></td>
          <td><strong>Backend Stack</strong></td>
          <td><strong>~$165.95/thÃ¡ng</strong></td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="cÃ¡c-bÆ°á»›c-tiáº¿p-theo">CÃ¡c BÆ°á»›c Tiáº¿p Theo</h2>
<p>Sau khi triá»ƒn khai Backend Stack:</p>
<ol>
<li><strong>Triá»ƒn khai Frontend Stack</strong> (Phase 5) - á»¨ng dá»¥ng Next.js trÃªn CloudFront</li>
<li><strong>Triá»ƒn khai Observability Stack</strong> (Phase 6) - CloudWatch dashboards vÃ  alarms</li>
<li><strong>Kiá»ƒm tra API Integration</strong> - XÃ¡c minh táº¥t cáº£ endpoints hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c</li>
<li><strong>Load Testing</strong> - Kiá»ƒm tra hiá»‡u nÄƒng vÃ  kháº£ nÄƒng má»Ÿ rá»™ng</li>
<li><strong>Security Audit</strong> - Xem láº¡i WAF rules vÃ  access controls</li>
</ol>
<hr>
<h2 id="tÃ i-liá»‡u-tham-kháº£o">TÃ i Liá»‡u Tham Kháº£o</h2>
<h3 id="infrastructure-code">Infrastructure Code</h3>
<ul>
<li><strong>Backend Stack</strong>: <code>infrastructure/lib/stacks/backend-stack.ts</code> (2965 dÃ²ng)</li>
<li><strong>Shared Layer Construct</strong>: <code>infrastructure/lib/constructs/shared-layer.ts</code></li>
</ul>
<h3 id="lambda-function-source-code-6-business-functions">Lambda Function Source Code (6 Business Functions)</h3>
<ul>
<li><strong>API Router</strong>: <code>services/api-router/</code> - Request routing &amp; JWT validation</li>
<li><strong>Auth User Module</strong>: <code>services/auth-module/</code> - Authentication &amp; user profiles</li>
<li><strong>Social Module</strong>: <code>services/social-module/</code> - Posts, comments, friends, notifications</li>
<li><strong>Recipe AI Module</strong>: <code>services/recipe-module/</code> - Recipe CRUD, AI generation, search</li>
<li><strong>Admin Module</strong>: <code>services/admin-module/</code> - Content moderation, user management</li>
<li><strong>Upload Module</strong>: <code>services/upload-module/</code> - S3 presigned URLs, file uploads</li>
</ul>
<h3 id="worker-lambda-source-code-2-active-workers">Worker Lambda Source Code (2 Active Workers)</h3>
<ul>
<li><strong>AI Worker</strong>: <code>services/ai-module/workers/</code> - Bedrock Claude 3 Haiku integration</li>
<li><strong>Image Worker</strong>: <code>services/image-worker/</code> - Image optimization (resize, compress)</li>
</ul>
<h3 id="shared-dependencies">Shared Dependencies</h3>
<ul>
<li><strong>Shared Layer</strong>: <code>layers/shared-dependencies/</code> - AWS SDK v3, uuid, jsonwebtoken, jwks-rsa</li>
</ul>
<h3 id="other-services-khÃ´ng-trong-backend-stack">Other Services (KhÃ´ng trong Backend Stack)</h3>
<ul>
<li><strong>WebSocket Module</strong>: <code>services/websocket-module/</code> - Real-time communication (stack riÃªng)</li>
<li><strong>Shared Utilities</strong>: <code>services/shared/</code> - Common utilities across services</li>
</ul>
<hr>
<h2 id="tÃ³m-táº¯t">TÃ³m Táº¯t</h2>
<p>Backend Stack lÃ  <strong>stack lá»›n nháº¥t vÃ  phá»©c táº¡p nháº¥t</strong> trong háº¡ táº§ng EveryoneCook. NÃ³ tá»•ng há»£p:</p>
<ul>
<li>API Gateway vá»›i custom domain (caching chá»‰ trong prod)</li>
<li>6 Lambda functions cho business logic</li>
<li>2 SQS queues hoáº¡t Ä‘á»™ng cho async processing (tá»•ng 4 vá»›i DLQs)</li>
<li>2 worker Lambda functions (AI Worker, Image Worker)</li>
<li>WAF Web ACL cho báº£o máº­t (5 quy táº¯c báº£o vá»‡)</li>
<li>CloudWatch monitoring vÃ  alarms</li>
</ul>
<p><strong>Thá»±c Sá»± ÄÆ°á»£c Triá»ƒn Khai</strong>: 8 Lambda functions, 4 SQS queues (2 hoáº¡t Ä‘á»™ng vá»›i workers), 1 WAF Web ACL, CloudWatch alarms</p>
<h3 id="development-environment-checklist">Development Environment Checklist</h3>
<ul>
<li>Chuáº©n bá»‹ táº¥t cáº£ Lambda deployment packages (8 functions + 1 layer)</li>
<li>Xem láº¡i cáº¥u hÃ¬nh mÃ´i trÆ°á»ng <strong>dev</strong></li>
<li>XÃ¡c minh caching <strong>táº¯t</strong> (chá»‰ prod)</li>
<li>Kiá»ƒm tra tá»«ng Lambda function Ä‘á»™c láº­p</li>
<li>Theo dÃµi CloudWatch alarms</li>
<li>XÃ¡c minh WAF rules khÃ´ng cháº·n legitimate traffic</li>
<li>Kiá»ƒm tra localhost CORS (chá»‰ dev)</li>
</ul>
<h3 id="cho-stagingproduction-deployment">Cho Staging/Production Deployment</h3>
<ul>
<li>Xem láº¡i <a href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.5-backend-stack/#s%e1%bb%b1-kh%c3%a1c-bi%e1%bb%87t-gi%e1%bb%afa-c%c3%a1c-environment">Sá»± KhÃ¡c Biá»‡t Giá»¯a CÃ¡c Environment</a></li>
<li>Báº­t API Gateway caching (chá»‰ prod)</li>
<li>Táº¯t data trace logging (chá»‰ prod)</li>
<li>Thiáº¿t láº­p log retention phÃ¹ há»£p (90 ngÃ y cho prod)</li>
<li>Cáº­p nháº­t WAF rate limits (cao hÆ¡n cho prod)</li>
<li>Loáº¡i bá» localhost khá»i CORS</li>
<li>Sá»­ dá»¥ng <code>--require-approval broadening</code> cho production</li>
</ul>
<p><strong>Thá»© Tá»± Triá»ƒn Khai</strong>: DNS â†’ Certificate â†’ Core â†’ Auth â†’ <strong>Backend</strong> â†’ Frontend â†’ Observability</p>
<p><strong>Environments</strong>: HÆ°á»›ng dáº«n nÃ y minh há»a triá»ƒn khai <strong>dev</strong>. Láº·p láº¡i cho <strong>staging</strong> vÃ  <strong>prod</strong> vá»›i cáº¥u hÃ¬nh phÃ¹ há»£p.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.4-auth-stack/" title="5.4.4 Auth Stack"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../../../vi/5-workshop/5.04-configure-stacks/5.4.6-frontend-stack/" title="5.4.6 Frontend Stack" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../../../js/clipboard.min.js?1765346855"></script>
    <script src="../../../../js/perfect-scrollbar.min.js?1765346855"></script>
    <script src="../../../../js/perfect-scrollbar.jquery.min.js?1765346855"></script>
    <script src="../../../../js/jquery.sticky.js?1765346855"></script>
    <script src="../../../../js/featherlight.min.js?1765346855"></script>
    <script src="../../../../js/highlight.pack.js?1765346855"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../../../js/modernizr.custom-3.6.0.js?1765346855"></script>
    <script src="../../../../js/learn.js?1765346855"></script>
    <script src="../../../../js/hugo-learn.js?1765346855"></script>

    <link href="../../../../mermaid/mermaid.css?1765346855" rel="stylesheet" />
    <script src="../../../../mermaid/mermaid.js?1765346855"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function (i, s, o, g, r, a, m) {
    i["GoogleAnalyticsObject"] = r;
    ((i[r] =
      i[r] ||
      function () {
        (i[r].q = i[r].q || []).push(arguments);
      }),
      (i[r].l = 1 * new Date()));
    ((a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]));
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m);
  })(
    window,
    document,
    "script",
    "https://www.google-analytics.com/analytics.js",
    "ga",
  );

  ga("create", "UA-158079754-2", "auto");
  ga("send", "pageview");
</script>

  </body>
</html>
